
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F1 Fantasy Team Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #080950, #000000);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Pantalla de login inicial */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #080950, #000000);
        }

        .login-container {
            background: rgba(0,0,0,0.8);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            max-width: 400px;
            width: 100%;
        }

        .login-container h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .login-container p {
            margin-bottom: 30px;
            color: #cccccc;
        }

        .login-container input {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border: none;
            font-size: 1.1em;
            background: rgba(255,255,255,0.9);
            color: black;
        }

        .login-container input::placeholder {
            color: #666;
        }

        .login-container button {
            background: linear-gradient(45deg, #ffff00, #ff8800);
            color: black;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.2em;
            width: 100%;
            transition: all 0.3s ease;
        }

        .login-container button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255,255,0,0.4);
        }

        .credentials-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            font-size: 0.9em;
        }

        /* Contenido principal (inicialmente oculto) */
        .main-content {
            display: none;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        /* Estilos para el men√∫ de usuario */
        .user-menu {
            position: absolute;
            top: 0;
            left: 0;
            display: flex;
            align-items: center;
        }

        .menu-button {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            font-size: 1.2em;
        }

        .menu-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: rgba(0,0,0,0.9);
            border-radius: 5px;
            padding: 10px;
            min-width: 250px;
            z-index: 100;
        }

        .menu-dropdown.show {
            display: block;
        }

        .menu-dropdown h4 {
            margin-bottom: 10px;
            color: #ffff00;
        }

        .history-item {
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .auth-section {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .username {
            margin-right: 10px;
        }

        .logout-button {
            background: #ff0000;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
        }

        .budget {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .budget h2 {
            margin-bottom: 10px;
        }

        .budget-display {
            font-size: 1.5em;
            font-weight: bold;
        }

        .section {
            background: rgba(255,255,255,0.1);
            margin-bottom: 20px;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .section h3 {
            margin-bottom: 15px;
            color: #ffff00;
            border-bottom: 2px solid #ffff00;
            padding-bottom: 5px;
        }

        .driver-grid, .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .driver-card, .team-card {
            background: rgba(0,0,0,0.3);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .driver-card:hover, .team-card:hover {
            border-color: #ffff00;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255,255,0,0.3);
        }

        .driver-card.selected, .team-card.selected {
            border-color: #00ff00;
            background: rgba(0,255,0,0.2);
        }

        .driver-image {
            width: 80px !important;
            height: 80px !important;
            object-fit: cover !important;
            object-position: center top !important;
            border-radius: 50% !important;
            margin-bottom: 10px !important;
            border: 2px solid rgba(255,255,255,0.3) !important;
            display: block !important;
            margin-left: auto !important;
            margin-right: auto !important;
        }

        .driver-name, .team-name {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .driver-team {
            color: #cccccc;
            margin-bottom: 10px;
        }

        .price {
            color: #ffff00;
            font-weight: bold;
            font-size: 1.1em;
        }

        .save-team {
            background: linear-gradient(45deg, #00ff00, #008800);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s ease;
        }

        .save-team:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,255,0,0.4);
        }

        .save-team:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .success {
            background: rgba(0,255,0,0.2);
            border: 1px solid #00ff00;
        }

        .error {
            background: rgba(255,0,0,0.2);
            border: 1px solid #ff0000;
        }

        .team-summary {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .selected-count {
            font-size: 0.9em;
            color: #ffff00;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Pantalla de login inicial -->
    <div class="login-screen" id="login-screen">
        <div class="login-container">
            <h1>üèéÔ∏è F1 Fantasy</h1>
            <p>Inicia sesi√≥n para acceder a las opciones de tu equipo</p>
            <input type="text" id="initial-username" placeholder="Nombre de usuario" required>
            <input type="password" id="initial-password" placeholder="Contrase√±a" required>
            <button id="initial-login-button">Iniciar Sesi√≥n</button>
            <div id="initial-message" class="message" style="display: none; margin-top: 20px;"></div>
            
            <div class="credentials-info">
                <strong>Credenciales de prueba:</strong><br>
                Usuario: jdoe | Contrase√±a: password1<br>
                Usuario: asmith | Contrase√±a: password2
            </div>
        </div>
    </div>

    <!-- Contenido principal -->
    <div class="main-content" id="main-content">
        <div class="container">
            <header>
                <div class="user-menu">
                    <button class="menu-button" id="menu-button">‚ò∞</button>
                    <div class="menu-dropdown" id="menu-dropdown">
                        <h4>Historial de movimientos de compra</h4>
                        <div id="history-list">
                            <!-- Historial se cargar√° aqu√≠ -->
                        </div>
                    </div>
                </div>
                
                <h1>üèéÔ∏è F1 Fantasy Teams üèéÔ∏è</h1>
                <p>Construye tu equipo con un presupuesto de $100M</p>
                
                <div class="auth-section">
                    <div id="user-info" class="user-info">
                        <span class="username" id="username-display"></span>
                        <button class="logout-button" id="logout-button">Cerrar sesi√≥n</button>
                    </div>
                </div>
            </header>

            <div class="budget">
                <h2>üí∞ Presupuesto disponible:</h2>
                <div class="budget-display">
                    $<span id="remaining-budget">100.0</span>M / $100.0M
                </div>
            </div>

            <div class="section">
                <h3>üèÅ Selecciona 5 pilotos</h3>
                <div class="selected-count">
                    Seleccionados: <span id="driver-count">0</span>/5
                </div>
                <div id="drivers-container" class="driver-grid">
                    <!-- Los pilotos se cargar√°n aqu√≠ -->
                </div>
            </div>

            <div class="section">
                <h3>üèÜ Selecciona 1 equipo</h3>
                <div class="selected-count">
                    Seleccionados: <span id="team-count">0</span>/1
                </div>
                <div id="teams-container" class="team-grid">
                    <!-- Los equipos se cargar√°n aqu√≠ -->
                </div>
            </div>

            <button id="save-team" class="save-team">Guardar equipo</button>

            <div id="message" class="message" style="display: none;"></div>

            <div id="team-summary" class="team-summary" style="display: none;">
                <h3>üìä Resumen del equipo</h3>
                <div id="summary-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Datos de usuarios (simulando una base de datos)
        const users = [
            { id: 1, username: 'jdoe', email: 'jdoe@example.com', password: 'password1' },
            { id: 2, username: 'asmith', email: 'asmith@example.com', password: 'password2' },
            { id: 3, username: 'bjohnson', email: 'bjohnson@example.com', password: 'password3' },
            { id: 4, username: 'cmiller', email: 'cmiller@example.com', password: 'password4' },
            { id: 5, username: 'dlee', email: 'dlee@example.com', password: 'password5' },
            { id: 6, username: 'ewilson', email: 'ewilson@example.com', password: 'password6' },
            { id: 7, username: 'fmoore', email: 'fmoore@example.com', password: 'password7' },
            { id: 8, username: 'gclark', email: 'gclark@example.com', password: 'password8' },
            { id: 9, username: 'hrodriguez', email: 'hrodriguez@example.com', password: 'password9' },
            { id: 10, username: 'ikim', email: 'ikim@example.com', password: 'password10' }
        ];

        // Datos de historial (simulado)
        const userHistory = {
            1: [
                { date: '2023-05-10', action: 'Equipo creado: Pilotos A, B, C, D, E - Escuder√≠a Mercedes' },
                { date: '2023-05-15', action: 'Equipo modificado: Cambi√≥ piloto E por F' }
            ],
            2: [
                { date: '2023-05-11', action: 'Equipo creado: Pilotos G, H, I, J, K - Escuder√≠a Ferrari' }
            ]
        };

        let drivers = [];
        let teams = [];
        let selectedDrivers = [];
        let selectedTeam = null;
        let totalBudget = 100.0;
        let currentUser = null;

        // Elementos del DOM
        const loginScreen = document.getElementById('login-screen');
        const mainContent = document.getElementById('main-content');
        const initialLoginButton = document.getElementById('initial-login-button');
        const initialMessage = document.getElementById('initial-message');
        const usernameDisplay = document.getElementById('username-display');
        const logoutButton = document.getElementById('logout-button');
        const menuButton = document.getElementById('menu-button');
        const menuDropdown = document.getElementById('menu-dropdown');
        const historyList = document.getElementById('history-list');

        // Event listeners
        initialLoginButton.addEventListener('click', handleInitialLogin);
        logoutButton.addEventListener('click', handleLogout);
        menuButton.addEventListener('click', () => {
            menuDropdown.classList.toggle('show');
        });

        // Permitir login con Enter
        document.getElementById('initial-username').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') handleInitialLogin();
        });
        document.getElementById('initial-password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') handleInitialLogin();
        });

        // Funci√≥n para manejar el login inicial
        function handleInitialLogin() {
            const username = document.getElementById('initial-username').value;
            const password = document.getElementById('initial-password').value;
            
            if (!username || !password) {
                showInitialMessage('Por favor, completa todos los campos', 'error');
                return;
            }
            
            // Validaci√≥n simple (en un caso real, esto ser√≠a con hash y backend seguro)
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                loginScreen.style.display = 'none';
                mainContent.style.display = 'block';
                usernameDisplay.textContent = currentUser.username;
                loadUserHistory();
                loadData();
                showMessage(`Bienvenido, ${user.username}!`, 'success');
            } else {
                showInitialMessage('Usuario o contrase√±a incorrectos', 'error');
            }
        }

        // Funci√≥n para manejar el logout
        function handleLogout() {
            currentUser = null;
            selectedDrivers = [];
            selectedTeam = null;
            loginScreen.style.display = 'flex';
            mainContent.style.display = 'none';
            document.getElementById('initial-username').value = '';
            document.getElementById('initial-password').value = '';
            document.getElementById('team-summary').style.display = 'none';
            updateUI();
        }

        // Cargar historial del usuario
        function loadUserHistory() {
            if (!currentUser) return;
            
            const history = userHistory[currentUser.id] || [];
            historyList.innerHTML = history.length > 0 ? 
                history.map(item => `
                    <div class="history-item">
                        <strong>${item.date}</strong>: ${item.action}
                    </div>
                `).join('') : 
                '<div class="history-item">No hay movimientos registrados</div>';
        }

        // Cargar datos (ahora directamente sin servidor)
        function loadData() {
            // Datos hardcodeados directamente en el c√≥digo
            drivers = [
                { 
                    id: 1, 
                    name: 'Oscar Piastri', 
                    team: 'McLaren', 
                    price: 16.8, 
                    number: 81, 
                    nationality: 'Australia',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/O/OSCPIA01_Oscar_Piastri/oscpia01.png.transform/1col/image.png'
                },
                { 
                    id: 2, 
                    name: 'Lando Norris', 
                    team: 'McLaren', 
                    price: 17.5, 
                    number: 4, 
                    nationality: 'United Kingdom',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/L/LANNOR01_Lando_Norris/lannor01.png.transform/1col/image.png'
                },
                { 
                    id: 3, 
                    name: 'Max Verstappen', 
                    team: 'Red Bull Racing', 
                    price: 19.5, 
                    number: 1, 
                    nationality: 'Netherlands',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/M/MAXVER01_Max_Verstappen/maxver01.png.transform/1col/image.png'
                },
                { 
                    id: 4, 
                    name: 'George Russell', 
                    team: 'Mercedes', 
                    price: 15.2, 
                    number: 63, 
                    nationality: 'United Kingdom',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/G/GEORUS01_George_Russell/georus01.png.transform/1col/image.png'
                },
                { 
                    id: 5, 
                    name: 'Charles Leclerc', 
                    team: 'Ferrari', 
                    price: 17.8, 
                    number: 16, 
                    nationality: 'Monaco',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/C/CHALEC01_Charles_Leclerc/chalec01.png.transform/1col/image.png'
                },
                { 
                    id: 6, 
                    name: 'Kimi Antonelli', 
                    team: 'Mercedes', 
                    price: 12.5, 
                    number: 12, 
                    nationality: 'Italy',
                    image: 'https://images.ctfassets.net/1fvlg6xqnm65/5YiTw6xQHuM94ty9yLDnyk/ff67d40c690940307f48d1b370352577/Kimi_Antonelli.png'
                },
                { 
                    id: 7, 
                    name: 'Lewis Hamilton', 
                    team: 'Ferrari', 
                    price: 18.2, 
                    number: 44, 
                    nationality: 'United Kingdom',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/L/LEWHAM01_Lewis_Hamilton/lewham01.png.transform/1col/image.png'
                },
                { 
                    id: 8, 
                    name: 'Alexander Albon', 
                    team: 'Williams', 
                    price: 10.8, 
                    number: 23, 
                    nationality: 'Thailand',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/A/ALEALB01_Alexander_Albon/alealb01.png.transform/1col/image.png'
                },
                { 
                    id: 9, 
                    name: 'Esteban Ocon', 
                    team: 'Haas', 
                    price: 11.5, 
                    number: 31, 
                    nationality: 'France',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/E/ESTOCO01_Esteban_Ocon/estoco01.png.transform/1col/image.png'
                },
                { 
                    id: 10, 
                    name: 'Lance Stroll', 
                    team: 'Aston Martin', 
                    price: 9.2, 
                    number: 18, 
                    nationality: 'Canada',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/L/LANSTR01_Lance_Stroll/lanstr01.png.transform/1col/image.png'
                },
                { 
                    id: 11, 
                    name: 'Yuki Tsunoda', 
                    team: 'Red Bull Racing', 
                    price: 10.3, 
                    number: 22, 
                    nationality: 'Japan',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/Y/YUKTSU01_Yuki_Tsunoda/yuktsu01.png.transform/1col/image.png'
                },
                { 
                    id: 12, 
                    name: 'Pierre Gasly', 
                    team: 'Alpine', 
                    price: 11.8, 
                    number: 10, 
                    nationality: 'France',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/P/PIEGAS01_Pierre_Gasly/piegas01.png.transform/1col/image.png'
                },
                { 
                    id: 13, 
                    name: 'Carlos Sainz', 
                    team: 'Williams', 
                    price: 14.7, 
                    number: 55, 
                    nationality: 'Spain',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/C/CARSAI01_Carlos_Sainz/carsai01.png.transform/1col/image.png'
                },
                { 
                    id: 14, 
                    name: 'Nico Hulkenberg', 
                    team: 'Kick Sauber', 
                    price: 9.5, 
                    number: 27, 
                    nationality: 'Germany',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/N/NICHUL01_Nico_Hulkenberg/nichul01.png.transform/1col/image.png'
                },
                { 
                    id: 15, 
                    name: 'Oliver Bearman', 
                    team: 'Haas', 
                    price: 8.5, 
                    number: 87, 
                    nationality: 'United Kingdom',
                    image: 'https://soymotor.com/sites/default/files/2025-03/obearman_2025.png'
                },
                { 
                    id: 16, 
                    name: 'Isack Hadjar', 
                    team: 'Racing Bulls', 
                    price: 7.8, 
                    number: 6, 
                    nationality: 'France',
                    image: 'https://e0.365dm.com/f1/drivers/256x256/h_full_1551.png'
                },
                { 
                    id: 17, 
                    name: 'Fernando Alonso', 
                    team: 'Aston Martin', 
                    price: 13.1, 
                    number: 14, 
                    nationality: 'Spain',
                    image: 'https://www.formula1.com/content/dam/fom-website/drivers/F/FERALO01_Fernando_Alonso/feralo01.png.transform/1col/image.png'
                },
                { 
                    id: 18, 
                    name: 'Liam Lawson', 
                    team: 'Racing Bulls', 
                    price: 8.2, 
                    number: 30, 
                    nationality: 'New Zealand',
                    image: 'https://image-service.zaonce.net/eyJidWNrZXQiOiJmcm9udGllci1jbXMiLCJrZXkiOiJmMW1hbmFnZXIvMjAyMy9kcml2ZXJzL2hlYWRzaG90cy9mMS9sYXcucG5nIiwiZWRpdHMiOnsicmVzaXplIjp7IndpZHRoIjo1MDB9fX0='
                },
                { 
                    id: 19, 
                    name: 'Jack Doohan', 
                    team: 'Alpine', 
                    price: 7.5, 
                    number: 7, 
                    nationality: 'Australia',
                    image: 'https://soymotor.com/sites/default/files/2025-03/jdoohan_2025.png'
                },
                { 
                    id: 20, 
                    name: 'Gabriel Bortoleto', 
                    team: 'Kick Sauber', 
                    price: 7.0, 
                    number: 5, 
                    nationality: 'Brazil',
                    image: 'https://e0.365dm.com/f1/drivers/256x256/h_full_1568.png'
                }
            ];
            
            teams = [
                { 
                    id: 1, 
                    name: 'McLaren', 
                    price: 32.5,
                    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/mclaren-logo.png'
                },
                { 
                    id: 2, 
                    name: 'Ferrari', 
                    price: 34.8,
                    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/ferrari-logo.png'
                },
                { 
                    id: 3, 
                    name: 'Red Bull Racing', 
                    price: 36.2,
                    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/red-bull-racing-logo.png'
                },
                { 
                    id: 4, 
                    name: 'Mercedes', 
                    price: 28.9,
                    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/mercedes-logo.png'
                },
                { 
                    id: 5, 
                    name: 'Aston Martin', 
                    price: 22.1,
                    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/aston-martin-logo.png'
                },
                { 
                    id: 6, 
                    name: 'Alpine', 
                    price: 19.3,
    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/alpine-logo.png'
  },
  { 
    id: 7, 
    name: 'Williams', 
    price: 25.4,
    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/williams-logo.png'
  },
  { 
    id: 8, 
    name: 'Racing Bulls', 
    price: 16.0,
    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/rb-logo.png'
  },
  { 
    id: 9, 
    name: 'Haas', 
    price: 23.0,
    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/haas-f1-team-logo.png'
  },
  { 
    id: 10, 
    name: 'Kick Sauber', 
    price: 16.5,
    image: 'https://media.formula1.com/d_team_car_fallback_image.png/content/dam/fom-website/teams/2024/kick-sauber-logo.png'
  }
];
                
                renderDrivers();
                renderTeams();
            }
        
function renderDrivers() {
    const container = document.getElementById('drivers-container');
    container.innerHTML = drivers.map(driver => `
        <div class="driver-card" data-id="${driver.id}">
            ${driver.image ? 
                `<img src="${driver.image}" alt="${driver.name}" class="driver-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                 <div class="driver-placeholder" style="display: none; width: 60px; height: 60px; border-radius: 50%; background: rgba(255,255,255,0.1); align-items: center; justify-content: center; font-size: 24px; margin-bottom: 10px;">üèéÔ∏è</div>` :
                `<div class="driver-placeholder" style="width: 60px; height: 60px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 24px; margin-bottom: 10px;">üèéÔ∏è</div>`
            }
            <div class="driver-name">${driver.name}</div>
            <div class="driver-team">${driver.team}</div>
            ${driver.number ? `<div style="color: #ccc; font-size: 0.9em;">#${driver.number}</div>` : ''}
            <div class="price">$${driver.price}M</div>
        </div>
    `).join('');

    // Agregar event listeners
    container.querySelectorAll('.driver-card').forEach(card => {
        card.addEventListener('click', () => selectDriver(parseInt(card.dataset.id)));
    });
}

function renderTeams() {
    const container = document.getElementById('teams-container');
    container.innerHTML = teams.map(team => `
        <div class="team-card" data-id="${team.id}">
            ${team.image ? 
                `<img src="${team.image}" alt="${team.name}" class="team-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                 <div class="team-placeholder" style="display: none; width: 50px; height: 50px; border-radius: 8px; background: rgba(255,255,255,0.1); align-items: center; justify-content: center; font-size: 20px; margin-bottom: 8px;">üèÅ</div>` :
                `<div class="team-placeholder" style="width: 50px; height: 50px; border-radius: 8px; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 20px; margin-bottom: 8px;">üèÅ</div>`
            }
            <div class="team-name">${team.name}</div>
            <div class="price">$${team.price}M</div>
        </div>
    `).join('');

    // Agregar event listeners
    container.querySelectorAll('.team-card').forEach(card => {
        card.addEventListener('click', () => selectTeam(parseInt(card.dataset.id)));
    });
}

function selectDriver(driverId) {
    const driverIndex = selectedDrivers.indexOf(driverId);
    
    if (driverIndex > -1) {
        // Deseleccionar piloto
        selectedDrivers.splice(driverIndex, 1);
    } else {
        // Seleccionar piloto (m√°ximo 5)
        if (selectedDrivers.length < 5) {
            selectedDrivers.push(driverId);
        } else {
            showMessage('Solo puedes seleccionar 5 pilotos', 'error');
            return;
        }
    }
    
    updateUI();
}

function selectTeam(teamId) {
    selectedTeam = selectedTeam === teamId ? null : teamId;
    updateUI();
}

function updateUI() {
    // Actualizar cards seleccionadas
    document.querySelectorAll('.driver-card').forEach(card => {
        const driverId = parseInt(card.dataset.id);
        card.classList.toggle('selected', selectedDrivers.includes(driverId));
    });

    document.querySelectorAll('.team-card').forEach(card => {
        const teamId = parseInt(card.dataset.id);
        card.classList.toggle('selected', selectedTeam === teamId);
    });

    // Actualizar contadores
    document.getElementById('driver-count').textContent = selectedDrivers.length;
    document.getElementById('team-count').textContent = selectedTeam ? 1 : 0;

    // Calcular presupuesto usado
    const usedBudget = calculateUsedBudget();
    const remainingBudget = totalBudget - usedBudget;
    
    document.getElementById('remaining-budget').textContent = remainingBudget.toFixed(1);
    
    // Habilitar/deshabilitar bot√≥n guardar
    const saveButton = document.getElementById('save-team');
    const canSave = selectedDrivers.length === 5 && selectedTeam && remainingBudget >= 0;
    saveButton.disabled = !canSave;
}

function calculateUsedBudget() {
    let total = 0;
    
    selectedDrivers.forEach(driverId => {
        const driver = drivers.find(d => d.id === driverId);
        if (driver) total += driver.price;
    });
    
    if (selectedTeam) {
        const team = teams.find(t => t.id === selectedTeam);
        if (team) total += team.price;
    }
    
    return total;
}

async function saveTeam() {
    try {
        const response = await fetch('/api/team', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                userId: currentUser.id,
                selectedDrivers,
                selectedTeam
            })
        });

        const data = await response.json();
        
        if (response.ok) {
            showMessage('¬°Equipo comprado exitosamente!', 'success');
            showPurchaseSummary();
            addToHistory();
        } else {
            showMessage(data.error || 'Error al comprar el equipo', 'error');
        }
    } catch (error) {
        showMessage('¬°Equipo comprado exitosamente! (modo offline)', 'success');
        showPurchaseSummary();
        addToHistory();
    }
}

function showPurchaseSummary() {
    const summaryDiv = document.getElementById('team-summary');
    const contentDiv = document.getElementById('summary-content');
    
    if (!summaryDiv || !contentDiv) {
        console.error('Elementos de resumen no encontrados');
        return;
    }
    
    // Obtener datos de pilotos seleccionados
    const selectedDriversData = selectedDrivers.map(id => 
        drivers.find(d => d.id === id)
    ).filter(driver => driver !== undefined);
    
    // Obtener datos del equipo seleccionado
    const selectedTeamData = teams.find(t => t.id === selectedTeam);
    
    if (!selectedTeamData) {
        console.error('Equipo seleccionado no encontrado');
        return;
    }
    
    const totalCost = calculateUsedBudget();
    const remainingBudget = totalBudget - totalCost;
    
    // Calcular costo total de pilotos
    const driversCost = selectedDriversData.reduce((sum, driver) => sum + driver.price, 0);
    
    contentDiv.innerHTML = `
        <div style="background: rgba(0,0,0,0.8); padding: 20px; border-radius: 15px; border: 2px solid #00ff88;">
            <h3 style="color: #00ff88; text-align: center; margin-bottom: 20px;">üìã RESUMEN DE COMPRA</h3>
            
            <div style="margin-bottom: 15px;">
                <h4 style="color: #00ff88; margin-bottom: 10px;">üèéÔ∏è Pilotos Seleccionados:</h4>
                <ul style="list-style: none; padding: 0;">
                    ${selectedDriversData.map(driver => 
                        `<li style="padding: 5px 0; border-bottom: 1px solid #333;">
                            <span style="color: white;">${driver.name}</span> 
                            <span style="color: #ccc;">(${driver.team})</span> 
                            <span style="color: #00ff88; float: right;">$${driver.price}M</span>
                        </li>`
                    ).join('')}
                </ul>
                <div style="text-align: right; margin-top: 10px; padding-top: 10px; border-top: 1px solid #333;">
                    <strong style="color: #00ff88;">Subtotal Pilotos: $${driversCost.toFixed(1)}M</strong>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <h4 style="color: #00ff88; margin-bottom: 10px;">üèÅ Escuder√≠a Seleccionada:</h4>
                <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <span style="color: white;">${selectedTeamData.name}</span>
                    <span style="color: #00ff88; float: right;">$${selectedTeamData.price}M</span>
                </div>
            </div>
            
            <div style="border-top: 2px solid #00ff88; padding-top: 15px; margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <strong style="color: white;">üí∞ TOTAL PAGADO:</strong>
                    <strong style="color: #00ff88; font-size: 1.2em;">$${totalCost.toFixed(1)}M</strong>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                    <span style="color: #ccc;">üí≥ Presupuesto Inicial:</span>
                    <span style="color: #ccc;">$${totalBudget}M</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <strong style="color: white;">üíµ Presupuesto Restante:</strong>
                    <strong style="color: ${remainingBudget >= 0 ? '#00ff88' : '#ff4444'};">$${remainingBudget.toFixed(1)}M</strong>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="closePurchaseSummary()" style="background: #00ff88; color: black; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    ‚úÖ Cerrar Resumen
                </button>
            </div>
        </div>
    `;
    
    summaryDiv.style.display = 'block';
    summaryDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function addToHistory() {
    // Inicializar historial si no existe
    if (!userHistory[currentUser.id]) {
        userHistory[currentUser.id] = [];
    }
    
    // Obtener datos detallados
    const selectedDriversData = selectedDrivers.map(id => 
        drivers.find(d => d.id === id)
    ).filter(driver => driver !== undefined);
    
    const selectedTeamData = teams.find(t => t.id === selectedTeam);
    const totalCost = calculateUsedBudget();
    const remainingBudget = totalBudget - totalCost;
    
    // Crear resumen para historial
    const driversList = selectedDriversData.map(driver => 
        `${driver.name} ($${driver.price}M)`
    ).join(', ');
    
    const historyEntry = {
        date: new Date().toISOString().split('T')[0],
        time: new Date().toLocaleTimeString(),
        action: `üí∞ COMPRA REALIZADA`,
        details: `Pilotos: ${driversList} | Escuder√≠a: ${selectedTeamData.name} ($${selectedTeamData.price}M) | Total: $${totalCost.toFixed(1)}M | Restante: $${remainingBudget.toFixed(1)}M`
    };
    
    userHistory[currentUser.id].push(historyEntry);
    
    // Actualizar visualizaci√≥n del historial
    updateHistoryDisplay();
}

function updateHistoryDisplay() {
    const historyContainer = document.getElementById('history-container');
    if (!historyContainer || !currentUser) return;
    
    const userHistoryData = userHistory[currentUser.id] || [];
    
    if (userHistoryData.length === 0) {
        historyContainer.innerHTML = '<p style="color: #ccc; text-align: center;">üìù No hay historial disponible</p>';
        return;
    }
    
    historyContainer.innerHTML = userHistoryData
        .slice(-10) // Mostrar √∫ltimas 10 entradas
        .reverse() // Mostrar m√°s recientes primero
        .map(entry => `
            <div class="history-entry" style="background: rgba(255,255,255,0.1); margin: 10px 0; padding: 15px; border-radius: 8px; border-left: 4px solid #00ff88;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span style="color: #00ff88; font-weight: bold;">${entry.action}</span>
                    <span style="color: #ccc; font-size: 0.9em;">${entry.date} ${entry.time || ''}</span>
                </div>
                <div style="color: white; font-size: 0.9em; line-height: 1.4;">
                    ${entry.details}
                </div>
            </div>
        `).join('');
}

function closePurchaseSummary() {
    const summaryDiv = document.getElementById('team-summary');
    if (summaryDiv) {
        summaryDiv.style.display = 'none';
    }
}

function showMessage(text, type) {
    const messageDiv = document.getElementById('message');
    if (messageDiv) {
        messageDiv.textContent = text;
        messageDiv.className = `message ${type}`;
        messageDiv.style.display = 'block';
        
        setTimeout(() => {
            messageDiv.style.display = 'none';
        }, 5000);
    }
}

function showInitialMessage(text, type) {
    const initialMessage = document.getElementById('initial-message');
    if (initialMessage) {
        initialMessage.textContent = text;
        initialMessage.className = `message ${type}`;
        initialMessage.style.display = 'block';
        
        setTimeout(() => {
            initialMessage.style.display = 'none';
        }, 5000);
    }
}

// Event listeners
document.getElementById('save-team').addEventListener('click', saveTeam);
    </script>
</body>
</html>
